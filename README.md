# Tutorly

Приложение для индивидуальных преподавателей, которое помогает планировать расписание занятий, вести базу учеников и контролировать оплату. Код уже содержит полноценный Compose-каркас, работу с Room и DI на Hilt.

## Что уже реализовано

### Навигация и базовый UI
- **Одноактивити-архитектура**: `MainActivity` разворачивает `AppTheme` и отрисовывает `AppNavRoot`, поэтому все экраны живут в Compose и получают зависимости через Hilt (`hiltViewModel`).
- **Scaffold с нижней навигацией**: корневой `Scaffold` управляет глобальным top bar и `AppBottomBar` с вкладками «Календарь», «Сегодня», «Ученики», «Финансы». При переходе на календарь навигация восстанавливает сохраненные параметры (выбранную дату и режим просмотра). 【F:app/src/main/java/com/tutorly/navigation/AppNav.kt†L55-L245】
- **Экранные диалоги**: редактор ученика открывается как полноэкранный диалог поверх графа, сохраняя состояние и возможность возврата. 【F:app/src/main/java/com/tutorly/navigation/AppNav.kt†L211-L229】

### Календарь занятий
- **Режимы День/Неделя/Месяц**: `CalendarViewModel` хранит якорную дату и выбранный режим в `SavedStateHandle`, восстанавливая их при пересоздании и вычисляя диапазон дат для запросов в репозиторий. 【F:app/src/main/java/com/tutorly/ui/CalendarViewModel.kt†L37-L135】
- **Наблюдение за уроками и статистикой**: данные календаря собираются из `LessonsRepository`, одновременно выгружая список занятий и недельную статистику (оплаченные, задолженности, общая сумма). 【F:app/src/main/java/com/tutorly/ui/CalendarViewModel.kt†L54-L123】
- **События UI**: вью-модель генерирует события открытия урока или создания нового слота, которые экран может обрабатывать без дублирования логики. 【F:app/src/main/java/com/tutorly/ui/CalendarViewModel.kt†L88-L105】

### Работа с учениками
- **Список с поиском и быстрыми действиями**: `StudentsScreen` включает поиск по имени/телефону, визуальные индикаторы долгов и FAB для создания ученика. Пустое состояние и snackbar-уведомления уже реализованы. 【F:app/src/main/java/com/tutorly/ui/screens/StudentsScreen.kt†L79-L200】
- **Редактор и интеграция с уроками**: экран умеет открываться из календаря для продолжения создания урока; после сохранения нового ученика запускается переданный callback, чтобы возобновить конфигурацию занятия. 【F:app/src/main/java/com/tutorly/navigation/AppNav.kt†L152-L186】
- **Профиль ученика**: `RoomStudentsRepository` агрегирует карточку ученика с метриками (оплаченные уроки, задолженность, средняя стоимость), списком недавних занятий и статусами предоплат. 【F:app/src/main/java/com/tutorly/data/repo/room/RoomStudentsRepository.kt†L21-L176】

### Архитектура данных и DI
- **Room-схема**: база `AppDatabase` хранит сущности `Student`, `Lesson`, `Payment`, `SubjectPreset`, конвертеры Instant/Enum подключены глобально. 【F:app/src/main/java/com/tutorly/data/db/AppDatabase.kt†L11-L34】
- **DI-модуль**: `DatabaseModule` поднимает базу, DAO и репозитории в `SingletonComponent`, включая распределение предоплат и заглушку настроек пользователя. 【F:app/src/main/java/com/tutorly/di/DatabaseModule.kt†L27-L74】
- **Слой домена**: интерфейсы репозиториев отделены в `domain`, что упрощает замену источников данных и тестирование (например, `StudentsRepository`). 【F:app/src/main/java/com/tutorly/domain/repo/StudentsRepository.kt†L1-L24】

### Дополнительные материалы
- В директории `docs/` лежат заметки по UX (например, план модального окна урока) и решение частых проблем со сборкой.

## Как запустить
1. Установите Android Studio Iguana или новее и откройте директорию `tutorly` как Gradle-проект.
2. Синхронизируйте зависимости (Gradle Wrapper уже в репозитории).
3. Соберите и запустите приложение на эмуляторе/устройстве: `./gradlew :app:installDebug`.
4. При первом запуске создастся локальная база `tutorly.db` (Room, destructive migration включен до появления миграций).

## Структура проекта
- `app/` — Android-приложение с навигацией, экранами Compose и DI-модулями.
- `docs/` — сопроводительные материалы: mind-map экранов, декомпозиция фич и описания UX-решений.
- `build.gradle.kts`, `settings.gradle.kts` и директория `gradle/` — конфигурация Gradle и подключение плагинов.
- `gradle.properties` — общие параметры сборки и настройки JVM.

## Полезные команды
- `./gradlew :app:assembleDebug` — собрать debug-APK без установки на устройство.
- `./gradlew test` — запустить unit-тесты (при их добавлении в проект).
- `./gradlew lint` — проверить кодстайл и потенциальные ошибки в UI и ресурсах.

## План развития
- **Реальные данные для календаря**: подключить `LessonsRepository` и `PaymentsRepository` к настоящим источникам, добавить загрузку демо-данных только в debug-сборках.
- **Экран «Сегодня»**: вывести карточки предстоящих уроков, быстрые действия (позвонить, отметить оплату), интегрировать метрики дня.
- **Раздел «Финансы»**: построить дашборд с динамикой доходов, задолженностями и фильтрами по периодам.
- **Миграции Room**: отказаться от `fallbackToDestructiveMigration`, покрыть базу тестами и подготовить сценарии обновления с прод-данными.
- **Тестирование**: добавить юнит-тесты для вью-моделей и репозиториев, использовать in-memory базу Room для проверки агрегирующей логики.
- **UX-улучшения**: поддержка темной темы, адаптивные размеры карточек в календаре, напоминания об уроках через WorkManager.
